<!-- ‚úÖ CalendarList TV Dashboard Mode -->
<div class="tv-container">
  <h1 class="tv-title">üì∫ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</h1>

  <div class="tv-submenu">
    <button class="tv-btn" onclick="switchMode('today')">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button>
    <button class="tv-btn" onclick="switchMode('week')">‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</button>
    <button class="tv-btn" onclick="switchMode('all')">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
    <button class="tv-btn" onclick="manualRefresh()">üîÑ Refresh</button>
  </div>

  <div id="bookingList" class="tv-list">
    ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...
  </div>
</div>

<style>
  .tv-container {
    padding: 30px;
    color: #ffffff;
    font-family: 'Kanit', sans-serif;
  }

  .tv-title {
    text-align: center;
    margin-bottom: 25px;
    font-size: 42px;
    font-weight: 700;
  }

  .tv-submenu {
    text-align: center;
    margin-bottom: 25px;
  }

  .tv-btn {
    background: #8ab4f8;
    border: none;
    padding: 14px 28px;
    border-radius: 10px;
    margin: 5px;
    cursor: pointer;
    font-size: 20px;
    font-weight: 600;
  }

  .tv-btn:hover {
    background: #a4c6fa;
  }

  .tv-list {
    background: #303134;
    border-radius: 15px;
    padding: 20px;
    height: calc(100vh - 220px);
    overflow-y: auto;
  }

  .tv-item {
    padding: 20px;
    border-bottom: 1px solid #4f5356;
  }

  .tv-item:last-child {
    border-bottom: none;
  }

  .tv-title-text {
    font-size: 28px;
    font-weight: 600;
  }

  .tv-time {
    font-size: 22px;
    opacity: 0.9;
    margin-top: 3px;
  }

  /* ‚úÖ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏ö‡∏ö‡∏™‡∏µ */
  .status {
    margin-top: 5px;
    font-size: 20px;
    font-weight: bold;
    display: inline-block;
    padding: 6px 14px;
    border-radius: 8px;
  }

  .status-booked {
    background: #1a73e8;
    color: white;
  }

  .status-done {
    background: #34a853;
    color: white;
  }

  .status-cancel {
    background: #ea4335;
    color: white;
  }
</style>

<script>
  let tvMode = "today";  // mode: today / week / all
  let autoSlideIndex = 0; // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö auto slide

  window.addEventListener("DOMContentLoaded", () => {
    window.currentView = "calendarlist"; // ‚úÖ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤ list
    loadBookings(tvMode);
    enableAutoRefresh();
    enableAutoSlide();
  });

  function switchMode(mode) {
    tvMode = mode;
    loadBookings(mode);
  }

  function manualRefresh() {
    loadBookings(tvMode);
  }

  // ‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å GAS
  function loadBookings(mode) {
    const listBox = document.getElementById("bookingList");
    listBox.innerHTML = "<h2>‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</h2>";

    google.script.run
      .withSuccessHandler(renderList)
      .getBookingList(mode);
  }

  // ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö TV Dashboard
  function renderList(data) {
    const box = document.getElementById("bookingList");

    if (!data || data.length === 0) {
      box.innerHTML = `<h2 style="text-align:center;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>`;
      return;
    }

    box.innerHTML = data.map(item => `
      <div class="tv-item">
        <div class="tv-title-text">${item.purpose}</div>
        <div class="tv-time">${item.date} ‡πÄ‡∏ß‡∏•‡∏≤ ${item.start} - ${item.end}</div>
        <div class="status ${mapStatus(item.status)}">${item.status}</div>
      </div>
    `).join("");
  }

  // ‚úÖ map status ‚Üí class ‡∏™‡∏µ
  function mapStatus(status) {
    if (!status) return "status-booked";

    const s = status.toLowerCase();

    if (s.includes("‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å")) return "status-cancel";
    if (s.includes("‡πÄ‡∏™‡∏£‡πá‡∏à") || s.includes("done")) return "status-done";
    return "status-booked";
  }

  // ‚úÖ Auto Refresh ‡∏ó‡∏∏‡∏Å 60 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
  function enableAutoRefresh() {
    setInterval(() => {
      if (window.currentView === "calendarlist") {
        console.log("‚úÖ Auto Refresh Triggered");
        loadBookings(tvMode);
      }
    }, 60000);
  }

  // ‚úÖ Auto Slide (‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ ‚Üí ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ ‚Üí ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)
  function enableAutoSlide() {
    setInterval(() => {
      if (window.currentView !== "calendarlist") return;

      autoSlideIndex = (autoSlideIndex + 1) % 3;

      if (autoSlideIndex === 0) switchMode("today");
      if (autoSlideIndex === 1) switchMode("week");
      if (autoSlideIndex === 2) switchMode("all");

      console.log("‚ñ∂Ô∏è Auto slide to:", tvMode);

    }, 15000); // 15 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤
  }
</script>
